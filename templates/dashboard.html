<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BC-Viz: ìœ ë°©ì•” ë°ì´í„° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'Nanum Gothic', sans-serif;
            overflow-x: hidden;
            transition: all 0.3s ease;
        }

        /* ë¼ì´íŠ¸/ë‹¤í¬ ê³µí†µ ë³€ìˆ˜ */
        :root {
            --bg-main: #e0eafc;
            --bg-sidebar: linear-gradient(180deg, #48BBB4 0%, #2a9d8f 100%);
            --bg-card: rgba(255, 255, 255, 0.9);
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-color: #48BBB4;
            --border-color: rgba(72, 187, 180, 0.2);
            --shadow: 0 8px 32px rgba(102, 126, 234, 0.1);
        }

        body.dark-mode {
            --bg-main: linear-gradient(135deg, #0a0e1a 0%, #0f172a 25%, #1a1f3a 50%, #1e293b 75%, #0f172a 100%);
            --bg-sidebar: linear-gradient(180deg, #1a365d 0%, #2d4a7c 50%, #1e3a5f 100%);
            --bg-card: rgba(30, 41, 59, 0.9);
            --text-primary: #f9fafb;
            --text-secondary: #e2e8f0;
            --accent-color: #48BBB4;
            --border-color: rgba(72, 187, 180, 0.4);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }
        
        /* body ë°°ê²½ë„ ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜ */
        body.light-mode {
            background: linear-gradient(
                135deg,
                #f8fafc 0%,
                #f1f5f9 25%,
                #e8f0f8 50%,
                #f1f5f9 75%,
                #f8fafc 100%
            );
            background-attachment: fixed;
        }
        
        body.dark-mode {
            background: linear-gradient(
                135deg,
                #0a0e1a 0%,
                #0f172a 20%,
                #1a1f3a 40%,
                #1e2540 60%,
                #1a2332 80%,
                #0f172a 100%
            );
            background-attachment: fixed;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* ë¡œê³  ì˜ì—­ */
        .logo-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 250px;
            height: 100px;
            background: var(--bg-sidebar);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.25rem;
            z-index: 1000;
            border-bottom: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        body.dark-mode .logo-container {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        .logo-container img {
            max-width: 100%;
            max-height: 70px;
            object-fit: contain;
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.1));
        }

        .logo-container h2 {
            font-size: 1.75rem;
            font-weight: 700;
            letter-spacing: -0.02em;
            color: #ffffff;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 250px;
            background: var(--bg-sidebar);
            padding-top: 100px;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 999;
            border-right: none;
            box-shadow: 2px 0 12px rgba(0, 0, 0, 0.08);
        }

        body.dark-mode .sidebar {
            box-shadow: 2px 0 12px rgba(0, 0, 0, 0.4);
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
        }

        .sidebar::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .sidebar-menu {
            list-style: none;
            padding: 1rem 0;
        }

        .sidebar-menu-item {
            padding: 1rem 1.5rem;
            color: rgba(255, 255, 255, 0.9);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border-left: 3px solid transparent;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 0.9375rem;
            margin: 0.25rem 0.5rem;
            border-radius: 8px;
        }

        .sidebar-menu-item span:first-child {
            font-size: 1.125rem;
        }

        .sidebar-menu-item:hover {
            background: rgba(255, 255, 255, 0.12);
            border-left-color: rgba(255, 255, 255, 0.8);
            color: #FFFFFF;
            transform: translateX(4px);
        }

        .sidebar-menu-item.active {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: #FFFFFF;
            font-weight: 600;
            color: #FFFFFF;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* ë‹¤í¬ ëª¨ë“œ í† ê¸€ */
        .theme-toggle {
            margin: 1rem;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            border-radius: 0.5rem;
            color: #FFFFFF;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* ì•…ì„± ë¶„ì„ ì²´í¬ë°•ìŠ¤ */
        .malignant-checkbox {
            margin: 1rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
        }

        .malignant-checkbox label {
            color: #FFFFFF;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .malignant-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        /* ë©”ì¸ ì½˜í…ì¸  */
        .main-content {
            margin-left: 250px;
            padding: 1rem 1.5rem;
            min-height: 100vh;
            width: calc(100% - 250px);
            max-width: none;
            background: var(--bg-main);
            overflow-y: auto;
        }

        /* ë°ìŠ¤í¬íƒ‘ ê¸°ì¤€ í™”ë©´ ê½‰ ì±„ìš°ê¸° */
        @media (min-width: 1024px) {
            .main-content {
                padding: 1.5rem 2rem;
                width: calc(100% - 250px);
            }
        }

        @media (min-width: 1400px) {
            .main-content {
                padding: 2rem 2.5rem;
            }
        }

        .main-content.light-mode {
            /* ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ë¼ì´íŠ¸ ëª¨ë“œ ê·¸ë¼ë°ì´ì…˜ - ë¶€ë“œëŸ¬ìš´ íŒŒìŠ¤í…” í†¤ */
            background: linear-gradient(
                135deg,
                #f0f4f8 0%,
                #e8f0f8 15%,
                #e0eafc 30%,
                #d6e4f0 45%,
                #e8f0f8 60%,
                #f0f7ff 75%,
                #e8f2ff 90%,
                #f0f4f8 100%
            );
            background-size: 400% 400%;
            animation: gradientShift 30s ease infinite;
        }

        body.dark-mode .main-content {
            /* ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ë‹¤í¬ ëª¨ë“œ ê·¸ë¼ë°ì´ì…˜ - ê¹Šê³  ìš°ì•„í•œ í†¤ */
            background: linear-gradient(
                135deg,
                #0a0e1a 0%,
                #0f172a 12%,
                #1a1f3a 25%,
                #1e2540 37%,
                #1a2332 50%,
                #1e293b 62%,
                #1a2f4a 75%,
                #152437 87%,
                #0f172a 100%
            );
            background-size: 400% 400%;
            animation: gradientShift 35s ease infinite;
        }
        
        /* ì¶”ê°€ ê³ ê¸‰ ê·¸ë¼ë°ì´ì…˜ íš¨ê³¼ (ë¼ë””ì–¼ ê·¸ë¼ë°ì´ì…˜ ì˜¤ë²„ë ˆì´) */
        .main-content.light-mode::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                ellipse 80% 50% at top right,
                rgba(72, 187, 180, 0.06) 0%,
                transparent 50%
            ),
            radial-gradient(
                ellipse 80% 50% at bottom left,
                rgba(102, 126, 234, 0.05) 0%,
                transparent 50%
            );
            pointer-events: none;
            z-index: 0;
        }

        body.dark-mode .main-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(
                ellipse 70% 40% at top right,
                rgba(72, 187, 180, 0.1) 0%,
                transparent 60%
            ),
            radial-gradient(
                ellipse 70% 40% at bottom left,
                rgba(42, 157, 143, 0.08) 0%,
                transparent 60%
            ),
            radial-gradient(
                circle 50% at center,
                rgba(30, 41, 59, 0.2) 0%,
                transparent 70%
            );
            pointer-events: none;
            z-index: 0;
        }

        /* ë©”ì¸ ì½˜í…ì¸  position ì„¤ì • */
        .main-content {
            position: relative;
        }

        /* ì½˜í…ì¸ ê°€ ë°°ê²½ ìœ„ì— í‘œì‹œë˜ë„ë¡ */
        .main-content > * {
            position: relative;
            z-index: 1;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* í˜ì´ì§€ í—¤ë” */
        .page-header {
            margin-bottom: 0.75rem;
            padding: 0.25rem 0;
        }

        .page-header h1 {
            font-size: 2.75rem;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 0.75rem;
            letter-spacing: -0.03em;
            background: linear-gradient(135deg, #48BBB4 0%, #2a9d8f 50%, #667eea 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        body.dark-mode .page-header h1 {
            background: linear-gradient(135deg, #48BBB4 0%, #2a9d8f 50%, #c4f1ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-header p {
            font-size: 1.125rem;
            color: #64748b;
            font-weight: 400;
            line-height: 1.6;
        }

        body.dark-mode .page-header p {
            color: #cbd5e1;
        }

        /* ê°œìš” í˜ì´ì§€ vs ë‚˜ë¨¸ì§€ í˜ì´ì§€ í—¤ë” í¬ê¸° ì°¨ì´ */
        .page-content:not(#page-overview) .page-header {
            margin-bottom: 0.5rem;
        }

        .page-content:not(#page-overview) .page-header h1 {
            font-size: 1.75rem;
            margin-bottom: 0.125rem;
        }

        .page-content:not(#page-overview) .page-header p {
            font-size: 0.9rem;
        }

        /* ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ */
        .widget-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 2rem;
            width: 100%;
        }

        /* ë°ìŠ¤í¬íƒ‘ì—ì„œ ê·¸ë¦¬ë“œ ê°„ê²© í™•ëŒ€ */
        @media (min-width: 1400px) {
            .widget-grid {
                gap: 2rem;
            }
        }

        /* ë°ì´í„° ê°œìš”ìš© */
        .widget-grid.overview-charts {
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .chart-container.overview-chart-item {
            min-height: 500px;
            max-height: 600px;
            aspect-ratio: 16 / 10;
        }

        #page-overview {
            height: auto;
            min-height: auto;
        }

        #page-overview .widget-grid.overview-charts {
            flex: none;
            min-height: auto;
        }

        #page-overview .chart-container {
            height: auto;
            min-height: 500px;
            max-height: 600px;
            aspect-ratio: 16 / 10;
        }

        @media (min-width: 1600px) {
            .widget-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 2rem;
            }
        }

        @media (max-width: 1200px) {
            .widget-grid {
                grid-template-columns: 1fr;
            }
        }

        /* ë‚˜ë¨¸ì§€ í˜ì´ì§€ */
        .page-content:not(#page-overview) {
            min-height: calc(100vh - 1.5rem);
            padding: 0;
        }

        .page-content:not(#page-overview) .page-header {
            flex-shrink: 0;
            margin-bottom: 0.75rem;
            padding: 0;
        }

        .page-content:not(#page-overview) .widget-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 1.25rem;
            margin-bottom: 1rem;
            padding: 0;
        }

        .page-content:not(#page-overview) .chart-container {
            width: 100%;
            max-width: 100%;
            background: #FFFFFF;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.04);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 0;
            display: flex;
            flex-direction: column;
            min-height: 500px;
            aspect-ratio: 4 / 3;
        }

        body.dark-mode .page-content:not(#page-overview) .chart-container {
            background: rgba(30, 41, 59, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .page-content:not(#page-overview) .chart-container h3 {
            margin-bottom: 0.75rem;
            font-size: 1.125rem;
            flex-shrink: 0;
        }

        .page-content:not(#page-overview) .chart-container > div:not(:first-child):not([class*="spinner"]) {
            flex: 1;
            min-height: 0;
            width: 100%;
            overflow: hidden;
        }

        .page-content:not(#page-overview) .chart-container.full-width-chart {
            grid-column: 1 / -1;
            aspect-ratio: 16 / 7;
            min-height: 550px;
        }

        /* ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ ì „ìš© ìŠ¤íƒ€ì¼ */
        #page-correlation .chart-container.full-width-chart {
            aspect-ratio: 1 / 1;
            min-height: 700px;
            max-height: none;
        }

        #page-correlation #correlation-chart {
            width: 100% !important;
            min-height: 700px !important;
            height: auto !important;
        }

        #page-correlation .js-plotly-plot {
            width: 100% !important;
            min-height: 700px !important;
            height: auto !important;
        }

        @media (max-width: 1200px) {
            .page-content:not(#page-overview) .widget-grid {
                grid-template-columns: 1fr;
            }

            .page-content:not(#page-overview) .chart-container.full-width-chart {
                grid-column: 1;
                aspect-ratio: 16 / 10;
            }
        }

        /* ë©”íŠ¸ë¦­ ê·¸ë¦¬ë“œ (ë‚˜ë¨¸ì§€ í˜ì´ì§€) */
        .page-content:not(#page-overview) .metric-grid {
            margin-bottom: 0.5rem;
            gap: 0.75rem;
        }

        /* ë²„íŠ¼/ì…ë ¥ í¬ê¸° ì¡°ì • */
        .page-content:not(#page-overview) .btn {
            margin: 0.25rem 0.25rem 0.25rem 0;
            padding: 0.625rem 1.25rem;
            font-size: 0.875rem;
        }

        .page-content:not(#page-overview) select,
        .page-content:not(#page-overview) input[type="number"] {
            margin: 0.25rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
        }

        /* ìœ„ì ¯ ì¹´ë“œ */
        .widget-card {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 1.75rem;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.04);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .widget-card {
            background: rgba(30, 41, 59, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .widget-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #48BBB4 0%, #2a9d8f 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .widget-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(72, 187, 180, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode .widget-card:hover {
            box-shadow: 0 8px 24px rgba(72, 187, 180, 0.25), 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .widget-card:hover::before {
            opacity: 1;
        }

        .widget-card h3 {
            color: #1e293b;
            margin-bottom: 1.25rem;
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }

        body.dark-mode .widget-card h3 {
            color: #FFFFFF;
        }

        /* ë©”íŠ¸ë¦­ ì¹´ë“œ */
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 1.25rem;
            margin-bottom: 2rem;
        }

        .metric-card {
            background: #FFFFFF;
            border-radius: 14px;
            padding: 1.75rem 1.5rem;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06), 0 1px 3px rgba(0, 0, 0, 0.04);
            text-align: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        body.dark-mode .metric-card {
            background: rgba(30, 41, 59, 0.95);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25), 0 2px 6px rgba(0, 0, 0, 0.15);
        }

        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #48BBB4 0%, #2a9d8f 100%);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(72, 187, 180, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08);
        }

        body.dark-mode .metric-card:hover {
            box-shadow: 0 6px 20px rgba(72, 187, 180, 0.2), 0 2px 8px rgba(0, 0, 0, 0.3);
        }

        .metric-card:hover::before {
            transform: scaleX(1);
        }

        .metric-card label {
            color: #64748b;
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: block;
            margin-bottom: 0.75rem;
        }

        body.dark-mode .metric-card label {
            color: #94a3b8;
        }

        .metric-card .value {
            color: #1e293b;
            font-size: 2.25rem;
            font-weight: 800;
            line-height: 1.2;
            letter-spacing: -0.02em;
        }

        body.dark-mode .metric-card .value {
            color: #FFFFFF;
        }

        /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        .chart-container {
            background: #FFFFFF;
            border-radius: 12px;
            padding: 1rem;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.04);
            margin-bottom: 1rem;
            transition: all 0.3s ease;
            width: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        body.dark-mode .chart-container {
            background: rgba(30, 41, 59, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        /* ë°ì´í„° ê°œìš” í˜ì´ì§€ì˜ ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
        #page-overview .chart-container {
            min-height: 500px;
            max-height: 600px;
        }

        #page-overview .chart-container.overview-chart-item {
            aspect-ratio: 4 / 3;
        }

        .chart-container:hover {
            box-shadow: 0 4px 16px rgba(72, 187, 180, 0.1), 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .chart-container h3 {
            color: #1e293b;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        body.dark-mode .chart-container h3 {
            color: #FFFFFF;
        }

        /* ë°ì´í„° í…Œì´ë¸” */
        .data-table {
            background: #FFFFFF;
            border-radius: 16px;
            padding: 2rem;
            border: none;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.04);
            overflow-x: auto;
        }

        body.dark-mode .data-table {
            background: rgba(30, 41, 59, 0.95);
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3), 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .data-table h3 {
            color: #1e293b;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 700;
        }

        body.dark-mode .data-table h3 {
            color: #FFFFFF;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 1rem 0.75rem;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            color: #475569;
            font-size: 0.9375rem;
        }

        body.dark-mode .data-table th,
        body.dark-mode .data-table td {
            border-bottom: 1px solid rgba(72, 187, 180, 0.2);
        }

        .data-table th {
            background: transparent;
            font-weight: 700;
            color: #48BBB4;
            text-transform: uppercase;
            font-size: 0.8125rem;
            letter-spacing: 0.5px;
        }

        .data-table tbody tr:hover {
            background: rgba(72, 187, 180, 0.05);
        }

        body.dark-mode .data-table tbody tr:hover {
            background: rgba(72, 187, 180, 0.1);
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 0.875rem 1.75rem;
            background: linear-gradient(135deg, #48BBB4 0%, #2a9d8f 100%);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9375rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            margin: 0.5rem 0.5rem 0.5rem 0;
            box-shadow: 0 2px 8px rgba(72, 187, 180, 0.25);
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover {
            background: linear-gradient(135deg, #2a9d8f 0%, #48BBB4 100%);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(72, 187, 180, 0.35);
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(72, 187, 180, 0.25);
        }

        /* ë¡œë”© ìŠ¤í”¼ë„ˆ */
        .spinner {
            border: 4px solid rgba(72, 187, 180, 0.3);
            border-top: 4px solid #48BBB4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none !important;
        }

        /* ì…ë ¥ í•„ë“œ */
        select, input[type="number"] {
            padding: 0.625rem 1rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            background: #FFFFFF;
            color: #1e293b;
            font-size: 0.9375rem;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 0.5rem;
            cursor: pointer;
        }

        body.dark-mode select,
        body.dark-mode input[type="number"] {
            border: 2px solid rgba(72, 187, 180, 0.3);
            background: rgba(30, 41, 59, 0.8);
            color: #FFFFFF;
        }

        select:hover, input[type="number"]:hover {
            border-color: #48BBB4;
            box-shadow: 0 0 0 3px rgba(72, 187, 180, 0.1);
        }

        select:focus, input[type="number"]:focus {
            outline: none;
            border-color: #48BBB4;
            box-shadow: 0 0 0 3px rgba(72, 187, 180, 0.15);
        }

        label {
            color: #475569;
            font-size: 0.9375rem;
            font-weight: 600;
            margin-right: 0.5rem;
        }

        body.dark-mode label {
            color: #cbd5e1;
        }

        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
            accent-color: #48BBB4;
        }

        /* Plotly ì°¨íŠ¸ í¬ê¸° í†µì¼ */
        .chart-container > div[id$="-chart"],
        .chart-container > div[id$="-plot"] {
            width: 100% !important;
            height: 100% !important;
            flex: 1 1 auto !important;
            min-height: 0 !important;
            background: transparent;
            position: relative;
        }

        .js-plotly-plot,
        .plotly {
            width: 100% !important;
            height: 100% !important;
            min-height: 450px !important;
        }

        /* ê°œìš” í˜ì´ì§€ ì°¨íŠ¸ */
        #page-overview .js-plotly-plot {
            min-height: 450px !important;
            height: 100% !important;
            font-size: 16px !important;
        }

        #page-overview .js-plotly-plot .xtick,
        #page-overview .js-plotly-plot .ytick {
            font-size: 14px !important;
        }

        #page-overview .js-plotly-plot .gtitle {
            font-size: 20px !important;
        }

        /* ë‚˜ë¨¸ì§€ í˜ì´ì§€ ì°¨íŠ¸ */
        .page-content:not(#page-overview) .js-plotly-plot {
            min-height: 450px !important;
            height: 100% !important;
            font-size: 14px !important;
        }

        .page-content:not(#page-overview) .chart-container.full-width-chart .js-plotly-plot {
            min-height: 500px !important;
            height: 100% !important;
        }

        /* í˜ì´ë“œ ì¸ */
        .page-content {
            animation: fadeIn 0.4s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to   { opacity: 1; transform: translateY(0); }
        }

        /* ë©”ì¸ ìŠ¤í¬ë¡¤ë°” */
        .main-content::-webkit-scrollbar {
            width: 8px;
        }

        .main-content::-webkit-scrollbar-track {
            background: transparent;
        }

        .main-content::-webkit-scrollbar-thumb {
            background: rgba(72, 187, 180, 0.3);
            border-radius: 4px;
        }

        .main-content::-webkit-scrollbar-thumb:hover {
            background: rgba(72, 187, 180, 0.5);
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 1400px) {
            .widget-grid {
                gap: 1rem;
            }
        }

        @media (max-width: 1200px) {
            .widget-grid {
                grid-template-columns: 1fr;
            }

            .widget-grid.overview-charts {
                grid-template-columns: 1fr;
            }

            .page-content:not(#page-overview) .widget-grid {
                grid-template-columns: 1fr;
            }

            .chart-container,
            .page-content:not(#page-overview) .chart-container {
                aspect-ratio: 4 / 3;
                min-height: 450px;
            }

            .chart-container.full-width-chart {
                aspect-ratio: 16 / 9;
                min-height: 500px;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            .main-content {
                margin-left: 200px;
                padding: 1rem;
            }
            .logo-container {
                width: 200px;
            }
            .widget-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            .metric-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 0.75rem;
            }

            .chart-container {
                padding: 0.75rem;
                min-height: 400px;
            }

            .js-plotly-plot {
                min-height: 400px !important;
                height: 400px !important;
            }
        }

        /* ===== ë‹¤í¬ ëª¨ë“œ í…ìŠ¤íŠ¸ ìƒ‰ ê°•í™” ===== */
        body.dark-mode {
            color: #f1f5f9;
        }

        body.dark-mode p,
        body.dark-mode span,
        body.dark-mode li,
        body.dark-mode div {
            color: #e2e8f0 !important;
        }

        body.dark-mode td,
        body.dark-mode th {
            color: #f1f5f9 !important;
        }

        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode h3,
        body.dark-mode h4,
        body.dark-mode h5,
        body.dark-mode h6 {
            color: #ffffff !important;
        }

        body.dark-mode .sidebar-menu-item {
            color: rgba(255, 255, 255, 0.95) !important;
        }

        body.dark-mode table th {
            color: #48BBB4 !important;
        }

        body.dark-mode table td {
            color: #f1f5f9 !important;
        }

        body.dark-mode label {
            color: #e2e8f0 !important;
        }

        body.dark-mode .metric-card label {
            color: #cbd5e1 !important;
        }

        body.dark-mode .page-header p {
            color: #e2e8f0 !important;
        }

        /* ë‹¤í¬ ëª¨ë“œ ì…ë ¥ í•„ë“œ ë° ë²„íŠ¼ í…ìŠ¤íŠ¸ */
        body.dark-mode input,
        body.dark-mode select,
        body.dark-mode textarea {
            color: #f1f5f9 !important;
        }

        body.dark-mode .btn {
            color: #ffffff !important;
        }

        body.dark-mode input::placeholder {
            color: #94a3b8 !important;
        }

        /* ë‹¤í¬ ëª¨ë“œ ëª¨ë“  í…ìŠ¤íŠ¸ ìš”ì†Œ ì¶”ê°€ ë³´ì¥ */
        body.dark-mode * {
            color: inherit;
        }

        body.dark-mode .chart-container h3,
        body.dark-mode .widget-card h3,
        body.dark-mode .data-table h3 {
            color: #ffffff !important;
        }

        /* Footer */
        .footer {
            position: relative;
            width: calc(100% - 250px);
            margin-left: 250px;
            padding: 2rem 2rem;
            text-align: center;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8) 0%, rgba(240, 245, 255, 0.9) 100%);
            border-top: 2px solid rgba(72, 187, 180, 0.3);
            color: #475569;
            font-size: 0.9375rem;
            margin-top: 3rem;
            clear: both;
            box-shadow: 0 -4px 20px rgba(72, 187, 180, 0.1);
            position: relative;
            overflow: hidden;
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #48BBB4 0%, #2a9d8f 50%, #667eea 100%);
            opacity: 0.8;
        }

        body.dark-mode .footer {
            background: linear-gradient(135deg, rgba(26, 35, 50, 0.95) 0%, rgba(30, 41, 59, 0.95) 50%, rgba(26, 54, 93, 0.95) 100%);
            border-top: 2px solid rgba(72, 187, 180, 0.5);
            color: #e2e8f0 !important;
            box-shadow: 0 -4px 20px rgba(72, 187, 180, 0.2);
        }

        body.dark-mode .footer::before {
            background: linear-gradient(90deg, #48BBB4 0%, #2a9d8f 30%, #48BBB4 60%, #667eea 100%);
            opacity: 0.9;
        }

        .footer p {
            margin: 0;
            padding: 0;
            color: inherit;
            font-weight: 600;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .footer p::before {
            content: 'ğŸ“Š';
            font-size: 1.2rem;
        }

        body.dark-mode .footer p {
            color: #e2e8f0 !important;
        }

        .footer p span {
            color: #48BBB4;
            font-weight: 700;
        }

        body.dark-mode .footer p span {
            color: #48BBB4 !important;
        }

        /* ë©”ì¸ ì½˜í…ì¸ ì— footer ê³µê°„ í™•ë³´ */
        .page-content:last-child {
            padding-bottom: 1rem;
            margin-bottom: 0;
        }

        /* ë°ìŠ¤í¬íƒ‘ì—ì„œ footer íŒ¨ë”© ì¡°ì • */
        @media (min-width: 1024px) {
            .footer {
                padding: 1.5rem 2rem;
            }
        }
    </style>
</head>
<body class="light-mode">
    <div class="container">
        <!-- ë¡œê³  -->
        <div class="logo-container">
            {% if logo_base64 %}
            <img src="data:image/png;base64,{{ logo_base64 }}" alt="BC-Viz Logo">
            {% else %}
            <h2>BC-Viz</h2>
            {% endif %}
        </div>

        <!-- ì‚¬ì´ë“œë°” -->
        <div class="sidebar">
            <button class="theme-toggle" onclick="toggleTheme()">
                <span id="theme-icon">ğŸŒ™</span>
            </button>

            <div class="malignant-checkbox">
                <label>
                    <input type="checkbox" id="malignant-checkbox" onchange="toggleMalignantAnalysis()">
                    <span>ğŸ”¬ ì•…ì„± ìœ ë°©ì•” ë°ì´í„° ì§‘ì¤‘ì ìœ¼ë¡œ ì‚´í´ë³´ê¸°</span>
                </label>
            </div>

            <ul class="sidebar-menu">
                <li class="sidebar-menu-item active" onclick="showPage('overview')">
                    <span>ğŸ </span> <span>ë°ì´í„° ê°œìš”</span>
                </li>
                <li class="sidebar-menu-item" onclick="showPage('visualization')">
                    <span>ğŸ“ˆ</span> <span>ë°ì´í„° ì‹œê°í™”</span>
                </li>
                <li class="sidebar-menu-item" onclick="showPage('ml-models')">
                    <span>ğŸ¤–</span> <span>ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸</span>
                </li>
                <li class="sidebar-menu-item" onclick="showPage('xai-analysis')">
                    <span>ğŸ”</span> <span>XAI ë¶„ì„</span>
                </li>
                <li class="sidebar-menu-item" onclick="showPage('dimension-reduction')">
                    <span>ğŸ—ºï¸</span> <span>ì°¨ì› ì¶•ì†Œ</span>
                </li>
                <li class="sidebar-menu-item" onclick="showPage('correlation')">
                    <span>ğŸ“Š</span> <span>ìƒê´€ê´€ê³„ ë¶„ì„</span>
                </li>
                <li class="sidebar-menu-item hidden" id="malignant-menu-item" onclick="showPage('malignant-analysis')">
                    <span>âš¡</span> <span>ì•…ì„± ì‹¬ê°ë„ ë¶„ì„</span>
                </li>
            </ul>
        </div>

        <!-- ë©”ì¸ -->
        <div class="main-content light-mode">
            <!-- ë°ì´í„° ê°œìš” -->
            <div id="page-overview" class="page-content">
                <div class="page-header">
                    <h1>ğŸ  ë°ì´í„° ê°œìš”</h1>
                    <p>ìœ ë°©ì•” ë°ì´í„°ì…‹ì˜ ê¸°ë³¸ í†µê³„ ë° ì •ë³´</p>
                </div>

                <div class="metric-grid" id="overview-metrics">
                    <div class="spinner"></div>
                </div>

                <div class="widget-grid overview-charts">
                    <div class="chart-container overview-chart-item">
                        <h3>ì§„ë‹¨ ë¶„í¬ (íŒŒì´ ì°¨íŠ¸)</h3>
                        <div id="diagnosis-pie-chart"></div>
                    </div>
                    <div class="chart-container overview-chart-item">
                        <h3>ì§„ë‹¨ë³„ ìƒ˜í”Œ ìˆ˜</h3>
                        <div id="diagnosis-bar-chart"></div>
                    </div>
                </div>

                <div class="data-table">
                    <h3>ğŸ“‹ ë°ì´í„° ë¯¸ë¦¬ë³´ê¸°</h3>
                    <div id="data-preview">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>

            <!-- ë°ì´í„° ì‹œê°í™” -->
            <div id="page-visualization" class="page-content hidden">
                <div class="page-header">
                    <h1>ğŸ“ˆ ë°ì´í„° ì‹œê°í™”</h1>
                    <p>ë‹¤ì–‘í•œ ì‹œê°í™” ë°©ë²•ìœ¼ë¡œ ë°ì´í„° íƒìƒ‰</p>
                </div>

                <div class="widget-grid">
                    <div class="chart-container">
                        <h3>ğŸ“¦ Boxplot - íŠ¹ì§•ë³„ ë¶„í¬</h3>
                        <div id="feature-selector">
                            <p>íŠ¹ì§• ì„ íƒ ì¤‘...</p>
                        </div>
                        <div id="boxplot-chart"></div>
                    </div>

                    <div class="chart-container">
                        <h3>ğŸ“Š íˆìŠ¤í† ê·¸ë¨ - ì§„ë‹¨ë³„ íŠ¹ì§• ë¶„í¬ ë¹„êµ</h3>
                        <div id="histogram-feature-selector"></div>
                        <div id="histogram-chart"></div>
                    </div>
                </div>
            </div>

            <!-- ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ -->
            <div id="page-ml-models" class="page-content hidden">
                <div class="page-header">
                    <h1>ğŸ¤– ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸</h1>
                    <p>Random Forest ë° Decision Tree ëª¨ë¸ ì„±ëŠ¥ ë¶„ì„</p>
                </div>

                <div class="metric-grid">
                    <div class="metric-card">
                        <label>Random Forest ì •í™•ë„</label>
                        <div class="value" id="rf-accuracy">-</div>
                    </div>
                    <div class="metric-card">
                        <label>Decision Tree ì •í™•ë„</label>
                        <div class="value" id="dt-accuracy">-</div>
                    </div>
                </div>

                <div class="widget-grid">
                    <div class="chart-container">
                        <h3>Random Forest Confusion Matrix</h3>
                        <div id="rf-cm-chart"></div>
                    </div>

                    <div class="chart-container">
                        <h3>Decision Tree Confusion Matrix</h3>
                        <div id="dt-cm-chart"></div>
                    </div>

                    <div class="chart-container full-width-chart">
                        <h3>Feature Importance (Random Forest)</h3>
                        <div id="feature-importance-chart"></div>
                    </div>
                </div>

                <button class="btn" onclick="trainModels()">ëª¨ë¸ í•™ìŠµ</button>
            </div>

            <!-- XAI ë¶„ì„ -->
            <div id="page-xai-analysis" class="page-content hidden">
                <div class="page-header">
                    <h1>ğŸ” XAI ë¶„ì„</h1>
                    <p>ì„¤ëª… ê°€ëŠ¥í•œ AI ê¸°ë²•ì„ í†µí•œ ëª¨ë¸ í•´ì„</p>
                </div>

                <div id="xai-notice" class="widget-card" style="margin-bottom: 2rem; padding: 2rem; text-align: center;">
                    <p id="xai-notice-text" style="font-size: 1.125rem; margin-bottom: 1rem;">
                        XAI ë¶„ì„ ê¸°ëŠ¥ì€ ëª¨ë¸ í•™ìŠµ í›„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                    <button id="xai-run-btn" class="btn hidden" onclick="runXAI()" style="display: none;">
                        XAI ë¶„ì„ ì‹¤í–‰
                    </button>
                </div>

                <div class="widget-grid">
                    <div class="chart-container">
                        <h3>SHAP ê°’ ë¶„ì„</h3>
                        <div id="xai-shap-chart"></div>
                    </div>

                    <div class="chart-container">
                        <h3>LIME ì„¤ëª…</h3>
                        <div id="xai-lime-chart"></div>
                    </div>
                </div>
            </div>

            <!-- ì°¨ì› ì¶•ì†Œ -->
            <div id="page-dimension-reduction" class="page-content hidden">
                <div class="page-header">
                    <h1>ğŸ—ºï¸ ì°¨ì› ì¶•ì†Œ</h1>
                    <p>PCA ë° t-SNEë¥¼ í†µí•œ ê³ ì°¨ì› ë°ì´í„° ì‹œê°í™”</p>
                </div>

                <div class="widget-grid">
                    <div class="chart-container">
                        <h3>PCA ì°¨ì› ì¶•ì†Œ</h3>
                        <label>ì£¼ì„±ë¶„ ê°œìˆ˜: </label>
                        <select id="pca-components" onchange="updatePCA()">
                            <option value="2">2D</option>
                            <option value="3">3D</option>
                        </select>
                        <button class="btn" onclick="updatePCA()">PCA ì‹¤í–‰</button>
                        <div id="pca-chart"></div>
                    </div>

                    <div class="chart-container">
                        <h3>t-SNE ì°¨ì› ì¶•ì†Œ</h3>
                        <label>ì°¨ì›: </label>
                        <select id="tsne-components">
                            <option value="2">2D</option>
                            <option value="3">3D</option>
                        </select>
                        <label>Perplexity: </label>
                        <input type="number" id="tsne-perplexity" value="30" min="5" max="50">
                        <button class="btn" onclick="updateTSNE()">t-SNE ì‹¤í–‰</button>
                        <div id="tsne-chart"></div>
                    </div>
                </div>
            </div>

            <!-- ìƒê´€ê´€ê³„ ë¶„ì„ -->
            <div id="page-correlation" class="page-content hidden">
                <div class="page-header">
                    <h1>ğŸ“Š ìƒê´€ê´€ê³„ ë¶„ì„</h1>
                    <p>íŠ¹ì§• ê°„ ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ</p>
                </div>

                <div class="widget-grid">
                    <div class="chart-container full-width-chart">
                        <h3>ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ</h3>
                        <button class="btn" onclick="loadCorrelationMatrix()">ìƒê´€ê´€ê³„ í–‰ë ¬ ë¡œë“œ</button>
                        <div id="correlation-chart"></div>
                    </div>
                </div>
            </div>

            <!-- ì•…ì„± ì‹¬ê°ë„ ë¶„ì„ -->
            <div id="page-malignant-analysis" class="page-content hidden">
                <div class="page-header">
                    <h1>âš¡ ì•…ì„± ì‹¬ê°ë„ ë¶„ì„</h1>
                    <p>ì•…ì„± ë°ì´í„°ë§Œì„ ëŒ€ìƒìœ¼ë¡œ í•œ ì‹¬ê°ë„ ë¶„ì„</p>
                </div>

                <div class="widget-grid">
                    <div class="chart-container full-width-chart">
                        <p><strong>ë¶„ì„ ëª©í‘œ:</strong> ì•…ì„± ë°ì´í„°ë§Œì„ ëŒ€ìƒìœ¼ë¡œ í•˜ì—¬, ì•…ì„± ë‚´ì—ì„œ ì–´ë–¤ íŠ¹ì§•ì´ ì•…ì„±ì˜ ì‹¬ê°ë„ì— ê°€ì¥ í° ì˜í–¥ì„ ì£¼ëŠ”ì§€ ë¶„ì„</p>
                        <button class="btn" onclick="analyzeMalignant()">ì•…ì„± ì‹¬ê°ë„ ë¶„ì„ ì‹¤í–‰</button>
                        <div id="malignant-results"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>ë°ì´í„° ì‹œê°í™” ê³¼ëª© <span>maker: seohaein</span></p>
    </footer>

<script>
    let currentPage = 'overview';
    let darkMode = false;
    let showMalignantAnalysis = false;
    let modelsTrained = false;

    // Plotly ë ˆì´ì•„ì›ƒì— ë‹¤í¬ ëª¨ë“œ ì„¤ì • ì ìš©
    function applyDarkModeToPlotlyLayout(layout) {
        if (!darkMode) return layout;
        
        const darkConfig = {
            font: { 
                color: '#e2e8f0',
                family: 'Malgun Gothic, sans-serif'
            },
            titlefont: { 
                color: '#ffffff'
            },
            xaxis: {
                titlefont: { color: '#e2e8f0' },
                tickfont: { color: '#cbd5e1' },
                gridcolor: 'rgba(72, 187, 180, 0.2)',
                zerolinecolor: 'rgba(72, 187, 180, 0.3)',
                linecolor: 'rgba(72, 187, 180, 0.3)'
            },
            yaxis: {
                titlefont: { color: '#e2e8f0' },
                tickfont: { color: '#cbd5e1' },
                gridcolor: 'rgba(72, 187, 180, 0.2)',
                zerolinecolor: 'rgba(72, 187, 180, 0.3)',
                linecolor: 'rgba(72, 187, 180, 0.3)'
            },
            legend: {
                font: { color: '#e2e8f0' },
                bgcolor: 'rgba(30, 41, 59, 0.8)',
                bordercolor: 'rgba(72, 187, 180, 0.3)'
            }
        };

        // ê¸°ì¡´ ë ˆì´ì•„ì›ƒê³¼ ë³‘í•©
        const mergedLayout = { ...layout };
        if (mergedLayout.font) {
            mergedLayout.font = { ...mergedLayout.font, ...darkConfig.font };
        } else {
            mergedLayout.font = darkConfig.font;
        }
        
        if (mergedLayout.title && mergedLayout.title.font) {
            mergedLayout.title.font = { ...mergedLayout.title.font, ...darkConfig.titlefont };
        } else if (mergedLayout.title) {
            mergedLayout.title.font = darkConfig.titlefont;
        }
        
        if (mergedLayout.xaxis) {
            mergedLayout.xaxis = { ...mergedLayout.xaxis, ...darkConfig.xaxis };
            if (mergedLayout.xaxis.title && mergedLayout.xaxis.title.font) {
                mergedLayout.xaxis.title.font = { ...mergedLayout.xaxis.title.font, color: '#e2e8f0' };
            }
            if (mergedLayout.xaxis.tickfont) {
                mergedLayout.xaxis.tickfont = { ...mergedLayout.xaxis.tickfont, color: '#cbd5e1' };
            }
        } else {
            mergedLayout.xaxis = darkConfig.xaxis;
        }
        
        if (mergedLayout.yaxis) {
            mergedLayout.yaxis = { ...mergedLayout.yaxis, ...darkConfig.yaxis };
            if (mergedLayout.yaxis.title && mergedLayout.yaxis.title.font) {
                mergedLayout.yaxis.title.font = { ...mergedLayout.yaxis.title.font, color: '#e2e8f0' };
            }
            if (mergedLayout.yaxis.tickfont) {
                mergedLayout.yaxis.tickfont = { ...mergedLayout.yaxis.tickfont, color: '#cbd5e1' };
            }
        } else {
            mergedLayout.yaxis = darkConfig.yaxis;
        }
        
        if (mergedLayout.legend) {
            mergedLayout.legend = { ...mergedLayout.legend, ...darkConfig.legend };
        } else {
            mergedLayout.legend = darkConfig.legend;
        }
        
        return mergedLayout;
    }

    document.addEventListener('DOMContentLoaded', function() {
        initializePage();
        loadOverview();
    });

    function initializePage() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            enableDarkMode();
        }

        const savedMalignant = localStorage.getItem('malignantAnalysis');
        if (savedMalignant === 'true') {
            document.getElementById('malignant-checkbox').checked = true;
            toggleMalignantAnalysis();
        }
    }

    function toggleTheme() {
        darkMode = !darkMode;
        if (darkMode) {
            enableDarkMode();
        } else {
            enableLightMode();
        }
    }

    function enableDarkMode() {
        document.body.classList.add('dark-mode');
        document.body.classList.remove('light-mode');
        document.querySelector('.main-content').classList.remove('light-mode');
        document.getElementById('theme-icon').textContent = 'â˜€ï¸';
        darkMode = true;
        localStorage.setItem('theme', 'dark');
        // ëª¨ë“  Plotly ì°¨íŠ¸ ì¬ë Œë”ë§
        updateAllPlotlyCharts();
    }

    function enableLightMode() {
        document.body.classList.remove('dark-mode');
        document.body.classList.add('light-mode');
        document.querySelector('.main-content').classList.add('light-mode');
        document.getElementById('theme-icon').textContent = 'ğŸŒ™';
        darkMode = false;
        localStorage.setItem('theme', 'light');
        // ëª¨ë“  Plotly ì°¨íŠ¸ ì¬ë Œë”ë§
        updateAllPlotlyCharts();
    }

    // ëª¨ë“  Plotly ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    function updateAllPlotlyCharts() {
        const plotlyCharts = document.querySelectorAll('.js-plotly-plot');
        plotlyCharts.forEach(chart => {
            const update = {
                font: { 
                    color: darkMode ? '#e2e8f0' : '#1e293b',
                    family: 'Malgun Gothic, sans-serif'
                },
                titlefont: { 
                    color: darkMode ? '#ffffff' : '#1e293b'
                },
                xaxis: {
                    titlefont: { color: darkMode ? '#e2e8f0' : '#1e293b' },
                    tickfont: { color: darkMode ? '#cbd5e1' : '#475569' },
                    gridcolor: darkMode ? 'rgba(72, 187, 180, 0.2)' : 'rgba(0, 0, 0, 0.1)',
                    zerolinecolor: darkMode ? 'rgba(72, 187, 180, 0.3)' : 'rgba(0, 0, 0, 0.2)'
                },
                yaxis: {
                    titlefont: { color: darkMode ? '#e2e8f0' : '#1e293b' },
                    tickfont: { color: darkMode ? '#cbd5e1' : '#475569' },
                    gridcolor: darkMode ? 'rgba(72, 187, 180, 0.2)' : 'rgba(0, 0, 0, 0.1)',
                    zerolinecolor: darkMode ? 'rgba(72, 187, 180, 0.3)' : 'rgba(0, 0, 0, 0.2)'
                },
                legend: {
                    font: { color: darkMode ? '#e2e8f0' : '#1e293b' }
                }
            };
            Plotly.relayout(chart, update);
        });
    }

    function toggleMalignantAnalysis() {
        showMalignantAnalysis = document.getElementById('malignant-checkbox').checked;
        const menuItem = document.getElementById('malignant-menu-item');

        if (showMalignantAnalysis) {
            menuItem.classList.remove('hidden');
        } else {
            menuItem.classList.add('hidden');
            if (currentPage === 'malignant-analysis') {
                showPage('overview');
            }
        }

        localStorage.setItem('malignantAnalysis', showMalignantAnalysis);
    }

    // ì°¨íŠ¸ ë†’ì´ í†µì¼
    function getChartHeight(isFullWidth = false) {
        if (currentPage === 'overview') {
            return 500;
        } else {
            // full-width ì°¨íŠ¸ëŠ” ë” ë†’ê²Œ
            if (isFullWidth) {
                return 550;
            }
            // ì¼ë°˜ ì°¨íŠ¸ëŠ” ì¼ì •í•œ ë†’ì´
            return 480;
        }
    }

    // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì°¨íŠ¸ ì—…ë°ì´íŠ¸
    let resizeTimer;
    window.addEventListener('resize', function() {
        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function() {
            const charts = document.querySelectorAll('.page-content:not(.hidden) .js-plotly-plot');
            charts.forEach(chart => {
                const newHeight = getChartHeight();
                Plotly.relayout(chart, { 
                    height: newHeight,
                    autosize: true 
                });
            });
        }, 250);
    });

    async function loadOverview() {
        try {
            const distRes = await fetch('/api/data/diagnosis-distribution');
            const distData = await distRes.json();
            const chartHeight = getChartHeight();

            const pieData = [{
                values: distData.values,
                labels: distData.labels,
                type: 'pie',
                marker: { colors: distData.colors },
                textinfo: 'label+percent',
                textposition: 'inside'
            }];

            const pieLayout = {
                title: { 
                    text: 'ì§„ë‹¨ ë¶„í¬', 
                    font: { 
                        size: 24, 
                        family: 'Malgun Gothic, sans-serif',
                        color: darkMode ? '#ffffff' : '#1e293b'
                    } 
                },
                font: { 
                    family: 'Malgun Gothic, sans-serif', 
                    size: 16,
                    color: darkMode ? '#e2e8f0' : '#1e293b'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: chartHeight,
                ...(darkMode ? {
                    xaxis: { tickfont: { color: '#cbd5e1' } },
                    yaxis: { tickfont: { color: '#cbd5e1' } },
                    legend: { font: { color: '#e2e8f0' } }
                } : {})
            };
            const finalPieLayout = applyDarkModeToPlotlyLayout(pieLayout);
            Plotly.newPlot('diagnosis-pie-chart', pieData, finalPieLayout, { responsive: true });

            const barData = [{
                x: distData.labels,
                y: distData.values,
                type: 'bar',
                marker: { color: distData.colors },
                textfont: { size: 16 }
            }];

            const barLayout = {
                title: { 
                    text: 'ì§„ë‹¨ë³„ ìƒ˜í”Œ ìˆ˜', 
                    font: { 
                        size: 24, 
                        family: 'Malgun Gothic, sans-serif',
                        color: darkMode ? '#ffffff' : '#1e293b'
                    } 
                },
                font: { 
                    family: 'Malgun Gothic, sans-serif', 
                    size: 16,
                    color: darkMode ? '#e2e8f0' : '#1e293b'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: chartHeight,
                xaxis: { 
                    title: { 
                        text: 'ì§„ë‹¨', 
                        font: { size: 18, color: darkMode ? '#e2e8f0' : '#1e293b' } 
                    }, 
                    tickfont: { size: 14, color: darkMode ? '#cbd5e1' : '#475569' },
                    gridcolor: darkMode ? 'rgba(72, 187, 180, 0.2)' : 'rgba(0, 0, 0, 0.1)'
                },
                yaxis: { 
                    title: { 
                        text: 'ìƒ˜í”Œ ìˆ˜', 
                        font: { size: 18, color: darkMode ? '#e2e8f0' : '#1e293b' } 
                    }, 
                    tickfont: { size: 14, color: darkMode ? '#cbd5e1' : '#475569' },
                    gridcolor: darkMode ? 'rgba(72, 187, 180, 0.2)' : 'rgba(0, 0, 0, 0.1)'
                }
            };
            const finalBarLayout = applyDarkModeToPlotlyLayout(barLayout);
            Plotly.newPlot('diagnosis-bar-chart', barData, finalBarLayout, { responsive: true });

            const overviewRes = await fetch('/api/data/overview');
            const overviewData = await overviewRes.json();

            if (overviewData.error) {
                document.getElementById('overview-metrics').innerHTML = `<p>ì˜¤ë¥˜: ${overviewData.error}</p>`;
                return;
            }

            document.getElementById('overview-metrics').innerHTML = `
                <div class="metric-card">
                    <label>ì´ ìƒ˜í”Œ ìˆ˜</label>
                    <div class="value">${overviewData.total_samples}</div>
                </div>
                <div class="metric-card">
                    <label>ì–‘ì„± (B) ìƒ˜í”Œ</label>
                    <div class="value">${overviewData.benign_count}</div>
                </div>
                <div class="metric-card">
                    <label>ì•…ì„± (M) ìƒ˜í”Œ</label>
                    <div class="value">${overviewData.malignant_count}</div>
                </div>
                <div class="metric-card">
                    <label>ì•…ì„± ë¹„ìœ¨</label>
                    <div class="value">${overviewData.malignant_pct}%</div>
                </div>
            `;

            const previewRes = await fetch('/api/data/preview');
            const previewData = await previewRes.json();

            if (previewData.error) {
                document.getElementById('data-preview').innerHTML = `<p>ì˜¤ë¥˜: ${previewData.error}</p>`;
                return;
            }

            let tableHTML = '<table><thead><tr>';
            previewData.columns.forEach(col => {
                tableHTML += `<th>${col}</th>`;
            });
            tableHTML += '</tr></thead><tbody>';

            previewData.data.forEach(row => {
                tableHTML += '<tr>';
                row.forEach(cell => {
                    tableHTML += `<td>${typeof cell === 'number' ? cell.toFixed(2) : cell}</td>`;
                });
                tableHTML += '</tr>';
            });
            tableHTML += '</tbody></table>';

            document.getElementById('data-preview').innerHTML = tableHTML;

        } catch (error) {
            console.error('ê°œìš” ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
            document.getElementById('overview-metrics').innerHTML = `<p>ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ${error.message}</p>`;
        }
    }

    async function loadVisualization() {
        try {
            const featuresRes = await fetch('/api/features/list');
            const featuresData = await featuresRes.json();

            if (featuresData.error) {
                document.getElementById('feature-selector').innerHTML = `<p>ì˜¤ë¥˜: ${featuresData.error}</p>`;
                return;
            }

            const features = featuresData.features.slice(0, 10);
            let checkboxesHTML = '<div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 1rem 0;">';
            features.forEach((feature, index) => {
                checkboxesHTML += `
                    <label style="display: flex; align-items: center; gap: 0.25rem;">
                        <input type="checkbox" class="feature-checkbox" value="${feature}" ${index < 5 ? 'checked' : ''}>
                        <span>${feature}</span>
                    </label>
                `;
            });
            checkboxesHTML += '</div>';
            checkboxesHTML += '<button class="btn" onclick="loadBoxplot()">Boxplot ìƒì„±</button>';
            document.getElementById('feature-selector').innerHTML = checkboxesHTML;

            let histCheckboxesHTML = '<div style="display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 1rem 0;">';
            features.slice(0, 10).forEach((feature, index) => {
                histCheckboxesHTML += `
                    <label style="display: flex; align-items: center; gap: 0.25rem;">
                        <input type="checkbox" class="hist-feature-checkbox" value="${feature}" ${index < 3 ? 'checked' : ''}>
                        <span>${feature}</span>
                    </label>
                `;
            });
            histCheckboxesHTML += '</div>';
            histCheckboxesHTML += '<button class="btn" onclick="loadHistogram()">íˆìŠ¤í† ê·¸ë¨ ìƒì„±</button>';
            document.getElementById('histogram-feature-selector').innerHTML = histCheckboxesHTML;

            loadBoxplot();
            loadHistogram();

        } catch (error) {
            console.error('ì‹œê°í™” í˜ì´ì§€ ë¡œë“œ ì˜¤ë¥˜:', error);
        }
    }

    async function loadBoxplot() {
        const selectedFeatures = Array.from(document.querySelectorAll('.feature-checkbox:checked'))
            .map(cb => cb.value);

        if (selectedFeatures.length === 0) {
            document.getElementById('boxplot-chart').innerHTML = '<p>ìµœì†Œ 1ê°œ ì´ìƒì˜ íŠ¹ì§•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>';
            return;
        }

        try {
            const params = new URLSearchParams();
            selectedFeatures.forEach(f => params.append('features', f));

            const res = await fetch(`/api/visualization/boxplot?${params.toString()}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById('boxplot-chart').innerHTML = `<p>ì˜¤ë¥˜: ${data.error}</p>`;
                return;
            }

            const traces = data.data.map(item => ({
                y: item.values,
                name: item.feature,
                type: 'box',
                boxmean: 'sd'
            }));

            const boxplotLayout = {
                title: { 
                    text: 'íŠ¹ì§•ë³„ Boxplot',
                    font: { 
                        family: 'Malgun Gothic, sans-serif',
                        color: darkMode ? '#ffffff' : '#1e293b'
                    }
                },
                font: { 
                    family: 'Malgun Gothic, sans-serif',
                    color: darkMode ? '#e2e8f0' : '#1e293b'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: getChartHeight()
            };
            const finalBoxplotLayout = applyDarkModeToPlotlyLayout(boxplotLayout);
            Plotly.newPlot('boxplot-chart', traces, finalBoxplotLayout, { responsive: true });

        } catch (error) {
            console.error('Boxplot ë¡œë“œ ì˜¤ë¥˜:', error);
            document.getElementById('boxplot-chart').innerHTML = `<p>ì˜¤ë¥˜: ${error.message}</p>`;
        }
    }

    async function loadHistogram() {
        const selectedFeatures = Array.from(document.querySelectorAll('.hist-feature-checkbox:checked'))
            .map(cb => cb.value);

        if (selectedFeatures.length === 0) {
            document.getElementById('histogram-chart').innerHTML = '<p>ìµœì†Œ 1ê°œ ì´ìƒì˜ íŠ¹ì§•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</p>';
            return;
        }

        try {
            const params = new URLSearchParams();
            selectedFeatures.forEach(f => params.append('features', f));

            const res = await fetch(`/api/visualization/histogram?${params.toString()}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById('histogram-chart').innerHTML = `<p>ì˜¤ë¥˜: ${data.error}</p>`;
                return;
            }

            const traces = [];
            data.data.forEach((item, idx) => {
                traces.push({
                    x: item.benign,
                    name: idx === 0 ? 'ì–‘ì„± (B)' : '',
                    type: 'histogram',
                    marker: { color: '#48BBB4' },
                    opacity: 0.7,
                    showlegend: idx === 0
                });
                traces.push({
                    x: item.malignant,
                    name: idx === 0 ? 'ì•…ì„± (M)' : '',
                    type: 'histogram',
                    marker: { color: '#FF6B9D' },
                    opacity: 0.7,
                    showlegend: idx === 0
                });
            });

            const histogramLayout = {
                title: { 
                    text: 'ì§„ë‹¨ë³„ íŠ¹ì§• ë¶„í¬ ë¹„êµ',
                    font: { 
                        family: 'Malgun Gothic, sans-serif',
                        color: darkMode ? '#ffffff' : '#1e293b'
                    }
                },
                font: { 
                    family: 'Malgun Gothic, sans-serif',
                    color: darkMode ? '#e2e8f0' : '#1e293b'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                barmode: 'overlay',
                height: getChartHeight()
            };
            const finalHistogramLayout = applyDarkModeToPlotlyLayout(histogramLayout);
            Plotly.newPlot('histogram-chart', traces, finalHistogramLayout, { responsive: true });

        } catch (error) {
            console.error('íˆìŠ¤í† ê·¸ë¨ ë¡œë“œ ì˜¤ë¥˜:', error);
            document.getElementById('histogram-chart').innerHTML = `<p>ì˜¤ë¥˜: ${error.message}</p>`;
        }
    }

    async function trainModels() {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'í•™ìŠµ ì¤‘...';

        try {
            const res = await fetch('/api/ml/train');
            const data = await res.json();

            if (data.error) {
                alert(`ì˜¤ë¥˜: ${data.error}`);
                btn.disabled = false;
                btn.textContent = 'ëª¨ë¸ í•™ìŠµ';
                return;
            }

            document.getElementById('rf-accuracy').textContent = `${(data.rf_accuracy * 100).toFixed(2)}%`;
            document.getElementById('dt-accuracy').textContent = `${(data.dt_accuracy * 100).toFixed(2)}%`;

            const rfCmLayout = {
                xaxis: { title: 'ì˜ˆì¸¡', tickvals: [0, 1], ticktext: ['ì–‘ì„± (B)', 'ì•…ì„± (M)'] },
                yaxis: { title: 'ì‹¤ì œ', tickvals: [0, 1], ticktext: ['ì–‘ì„± (B)', 'ì•…ì„± (M)'] },
                title: { 
                    text: 'Random Forest Confusion Matrix',
                    font: { 
                        family: 'Malgun Gothic, sans-serif',
                        color: darkMode ? '#ffffff' : '#1e293b'
                    }
                },
                font: { 
                    family: 'Malgun Gothic, sans-serif',
                    color: darkMode ? '#e2e8f0' : '#1e293b'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: getChartHeight()
            };
            const finalRfCmLayout = applyDarkModeToPlotlyLayout(rfCmLayout);
            Plotly.newPlot('rf-cm-chart', [{
                z: data.rf_cm,
                type: 'heatmap',
                colorscale: 'Blues',
                text: data.rf_cm.map(row => row.map(val => val.toString())),
                texttemplate: '%{text}',
                textfont: { size: 16, color: darkMode ? '#ffffff' : '#1e293b' },
                showscale: false
            }], finalRfCmLayout, { responsive: true });

            const dtCmLayout = {
                xaxis: { title: 'ì˜ˆì¸¡', tickvals: [0, 1], ticktext: ['ì–‘ì„± (B)', 'ì•…ì„± (M)'] },
                yaxis: { title: 'ì‹¤ì œ', tickvals: [0, 1], ticktext: ['ì–‘ì„± (B)', 'ì•…ì„± (M)'] },
                title: { 
                    text: 'Decision Tree Confusion Matrix',
                    font: { 
                        family: 'Malgun Gothic, sans-serif',
                        color: darkMode ? '#ffffff' : '#1e293b'
                    }
                },
                font: { 
                    family: 'Malgun Gothic, sans-serif',
                    color: darkMode ? '#e2e8f0' : '#1e293b'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: getChartHeight()
            };
            const finalDtCmLayout = applyDarkModeToPlotlyLayout(dtCmLayout);
            Plotly.newPlot('dt-cm-chart', [{
                z: data.dt_cm,
                type: 'heatmap',
                colorscale: 'Oranges',
                text: data.dt_cm.map(row => row.map(val => val.toString())),
                texttemplate: '%{text}',
                textfont: { size: 16, color: darkMode ? '#ffffff' : '#1e293b' },
                showscale: false
            }], finalDtCmLayout, { responsive: true });

            const featureImportanceLayout = {
                title: { 
                    text: 'Feature Importance (ìƒìœ„ 15ê°œ)',
                    font: { 
                        family: 'Malgun Gothic, sans-serif',
                        color: darkMode ? '#ffffff' : '#1e293b'
                    }
                },
                xaxis: { title: 'ì¤‘ìš”ë„' },
                yaxis: { title: 'íŠ¹ì§•' },
                font: { 
                    family: 'Malgun Gothic, sans-serif',
                    color: darkMode ? '#e2e8f0' : '#1e293b'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: getChartHeight(true)
            };
            const finalFeatureImportanceLayout = applyDarkModeToPlotlyLayout(featureImportanceLayout);
            Plotly.newPlot('feature-importance-chart', [{
                x: data.feature_importance.importance,
                y: data.feature_importance.features,
                type: 'bar',
                orientation: 'h',
                marker: { color: data.feature_importance.importance, colorscale: 'Viridis' }
            }], finalFeatureImportanceLayout, { responsive: true });

            btn.disabled = false;
            btn.textContent = 'ëª¨ë¸ í•™ìŠµ';

            modelsTrained = true;
            updateXAIButton();
            alert('ëª¨ë¸ í•™ìŠµì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ XAI ë¶„ì„ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');

        } catch (error) {
            console.error('ëª¨ë¸ í•™ìŠµ ì˜¤ë¥˜:', error);
            alert(`ì˜¤ë¥˜: ${error.message}`);
            btn.disabled = false;
            btn.textContent = 'ëª¨ë¸ í•™ìŠµ';
        }
    }

    function updateXAIButton() {
        const noticeText = document.getElementById('xai-notice-text');
        const runBtn = document.getElementById('xai-run-btn');

        if (modelsTrained) {
            noticeText.textContent = 'âœ… ëª¨ë¸ í•™ìŠµì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. XAI ë¶„ì„ì„ ì‹¤í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤!';
            noticeText.style.color = '#48BBB4';
            noticeText.style.fontWeight = '600';
            runBtn.classList.remove('hidden');
            runBtn.style.display = 'inline-block';
        } else {
            noticeText.textContent = 'XAI ë¶„ì„ ê¸°ëŠ¥ì€ ëª¨ë¸ í•™ìŠµ í›„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
            noticeText.style.color = '';
            noticeText.style.fontWeight = '400';
            runBtn.classList.add('hidden');
            runBtn.style.display = 'none';
        }
    }

    async function runXAI() {
        if (!modelsTrained) {
            alert('ë¨¼ì € ëª¨ë¸ì„ í•™ìŠµì‹œì¼œì£¼ì„¸ìš”.');
            return;
        }

        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'XAI ë¶„ì„ ì¤‘...';

        document.getElementById('xai-shap-chart').innerHTML = '<div class="spinner"></div><p>SHAP ë¶„ì„ ì¤‘...</p>';
        document.getElementById('xai-lime-chart').innerHTML = '<div class="spinner"></div><p>LIME ë¶„ì„ ì¤‘...</p>';

        try {
            const shapRes = await fetch('/api/xai/shap');
            if (!shapRes.ok) {
                const errorText = await shapRes.text();
                throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${shapRes.status}): ${errorText}`);
            }
            const shapData = await shapRes.json();

            if (shapData.error) {
                document.getElementById('xai-shap-chart').innerHTML = `<p style="color: red; padding: 2rem;">ì˜¤ë¥˜: ${shapData.error}</p>`;
            } else {
                Plotly.newPlot('xai-shap-chart', [{
                    x: shapData.importance,
                    y: shapData.features,
                    type: 'bar',
                    orientation: 'h',
                    marker: {
                        color: shapData.importance,
                        colorscale: 'Viridis'
                    }
                }], {
                    title: 'SHAP Feature Importance',
                    xaxis: { title: 'SHAP Value' },
                    yaxis: { title: 'Feature' },
                    font: { family: 'Malgun Gothic, sans-serif', size: 14 },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    height: getChartHeight()
                }, { responsive: true });
            }

            const limeRes = await fetch('/api/xai/lime');
            if (!limeRes.ok) {
                const errorText = await limeRes.text();
                throw new Error(`ì„œë²„ ì˜¤ë¥˜ (${limeRes.status}): ${errorText}`);
            }
            const limeData = await limeRes.json();

            if (limeData.error) {
                document.getElementById('xai-lime-chart').innerHTML = `<p style="color: red; padding: 2rem;">ì˜¤ë¥˜: ${limeData.error}</p>`;
            } else {
                let limeHTML = '<div style="padding: 1rem; height: 100%; overflow-y: auto;">';
                limeHTML += `<h4 style="margin-bottom: 1rem;">ì˜ˆì¸¡ ê²°ê³¼: ${limeData.prediction}</h4>`;
                limeHTML += `<h4 style="margin-bottom: 0.5rem; font-size: 0.9rem;">ì‹¤ì œ ë¼ë²¨: ${limeData.true_label || 'N/A'}</h4>`;
                limeHTML += '<h4 style="margin-bottom: 1rem; margin-top: 1.5rem;">íŠ¹ì§• ì¤‘ìš”ë„:</h4>';
                limeHTML += '<table style="width: 100%; border-collapse: collapse;">';
                limeData.explanation.forEach((item, idx) => {
                    const color = item.value > 0 ? '#48BBB4' : '#FF6B9D';
                    const bgColor = idx % 2 === 0 ? 'transparent' : 'rgba(0,0,0,0.02)';
                    limeHTML += `<tr style="border-bottom: 1px solid #e2e8f0; background: ${bgColor};">
                        <td style="padding: 0.75rem; width: 60%; font-size: 0.9rem;">${item.feature}</td>
                        <td style="padding: 0.75rem; text-align: right; color: ${color}; font-weight: 600;">${item.value > 0 ? '+' : ''}${item.value.toFixed(4)}</td>
                    </tr>`;
                });
                limeHTML += '</table></div>';
                document.getElementById('xai-lime-chart').innerHTML = limeHTML;
            }

            btn.disabled = false;
            btn.textContent = 'XAI ë¶„ì„ ì‹¤í–‰';
            alert('XAI ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');

        } catch (error) {
            console.error('XAI ë¶„ì„ ì˜¤ë¥˜:', error);
            const errorMsg = error.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.';
            alert(`ì˜¤ë¥˜: ${errorMsg}`);
            document.getElementById('xai-shap-chart').innerHTML = `<p style="color: red; padding: 2rem;">ì˜¤ë¥˜: ${errorMsg}</p>`;
            document.getElementById('xai-lime-chart').innerHTML = `<p style="color: red; padding: 2rem;">ì˜¤ë¥˜: ${errorMsg}</p>`;
            btn.disabled = false;
            btn.textContent = 'XAI ë¶„ì„ ì‹¤í–‰';
        }
    }

    function showPage(pageName) {
        document.querySelectorAll('.page-content').forEach(page => {
            page.classList.add('hidden');
        });
        document.getElementById(`page-${pageName}`).classList.remove('hidden');

        document.querySelectorAll('.sidebar-menu-item').forEach(item => {
            item.classList.remove('active');
        });
        event.target.closest('.sidebar-menu-item').classList.add('active');

        currentPage = pageName;

        if (pageName === 'xai-analysis') {
            updateXAIButton();
        }

        switch (pageName) {
            case 'overview':
                loadOverview();
                break;
            case 'visualization':
                loadVisualization();
                break;
        }
    }

    async function updatePCA() {
        const nComponents = parseInt(document.getElementById('pca-components').value);

        try {
            const res = await fetch(`/api/dimension-reduction/pca?n_components=${nComponents}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById('pca-chart').innerHTML = `<p>ì˜¤ë¥˜: ${data.error}</p>`;
                return;
            }

            let chartHTML = `
                <p><strong>ì„¤ëª…ëœ ë¶„ì‚° ë¹„ìœ¨:</strong> ${data.explained_variance.map(v => (v * 100).toFixed(2) + '%').join(', ')}</p>
                <p><strong>ì´ ì„¤ëª…ëœ ë¶„ì‚°:</strong> ${(data.total_explained * 100).toFixed(2)}%</p>
                <div id="pca-plot"></div>
            `;
            document.getElementById('pca-chart').innerHTML = chartHTML;

            if (nComponents === 2) {
                const traces = [{
                    x: data.data.map(d => d[0]),
                    y: data.data.map(d => d[1]),
                    mode: 'markers',
                    type: 'scatter',
                    marker: {
                        color: data.labels,
                        colorscale: [[0, '#48BBB4'], [1, '#FF6B9D']],
                        size: 5,
                        opacity: 0.7
                    },
                    text: data.labels.map(l => l === 0 ? 'ì–‘ì„± (B)' : 'ì•…ì„± (M)'),
                    hovertemplate: '%{text}<br>PC1: %{x:.2f}<br>PC2: %{y:.2f}<extra></extra>'
                }];

                Plotly.newPlot('pca-plot', traces, {
                    title: `PCA ${nComponents}D ì‹œê°í™”`,
                    xaxis: { title: `PC1 (${(data.explained_variance[0] * 100).toFixed(2)}%)` },
                    yaxis: { title: `PC2 (${(data.explained_variance[1] * 100).toFixed(2)}%)` },
                    font: { family: 'Malgun Gothic, sans-serif' },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    height: getChartHeight()
                }, { responsive: true });
            } else {
                const trace = {
                    x: data.data.map(d => d[0]),
                    y: data.data.map(d => d[1]),
                    z: data.data.map(d => d[2]),
                    mode: 'markers',
                    type: 'scatter3d',
                    marker: {
                        color: data.labels,
                        colorscale: [[0, '#48BBB4'], [1, '#FF6B9D']],
                        size: 3,
                        opacity: 0.7
                    },
                    text: data.labels.map(l => l === 0 ? 'ì–‘ì„± (B)' : 'ì•…ì„± (M)')
                };

                Plotly.newPlot('pca-plot', [trace], {
                    title: `PCA ${nComponents}D ì‹œê°í™”`,
                    scene: {
                        xaxis: { title: `PC1 (${(data.explained_variance[0] * 100).toFixed(2)}%)` },
                        yaxis: { title: `PC2 (${(data.explained_variance[1] * 100).toFixed(2)}%)` },
                        zaxis: { title: `PC3 (${(data.explained_variance[2] * 100).toFixed(2)}%)` }
                    },
                    font: { family: 'Malgun Gothic, sans-serif' },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    height: getChartHeight()
                }, { responsive: true });
            }

        } catch (error) {
            console.error('PCA ì˜¤ë¥˜:', error);
            document.getElementById('pca-chart').innerHTML = `<p>ì˜¤ë¥˜: ${error.message}</p>`;
        }
    }

    async function updateTSNE() {
        const nComponents = parseInt(document.getElementById('tsne-components').value);
        const perplexity = parseInt(document.getElementById('tsne-perplexity').value);

        document.getElementById('tsne-chart').innerHTML = '<div class="spinner"></div><p>t-SNE ê³„ì‚° ì¤‘... (ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)</p>';

        try {
            const res = await fetch(`/api/dimension-reduction/tsne?n_components=${nComponents}&perplexity=${perplexity}`);
            const data = await res.json();

            if (data.error) {
                document.getElementById('tsne-chart').innerHTML = `<p>ì˜¤ë¥˜: ${data.error}</p>`;
                return;
            }

            document.getElementById('tsne-chart').innerHTML = '<div id="tsne-plot"></div>';

            if (nComponents === 2) {
                const trace = {
                    x: data.data.map(d => d[0]),
                    y: data.data.map(d => d[1]),
                    mode: 'markers',
                    type: 'scatter',
                    marker: {
                        color: data.labels,
                        colorscale: [[0, '#48BBB4'], [1, '#FF6B9D']],
                        size: 5,
                        opacity: 0.7
                    },
                    text: data.labels.map(l => l === 0 ? 'ì–‘ì„± (B)' : 'ì•…ì„± (M)'),
                    hovertemplate: '%{text}<br>t-SNE 1: %{x:.2f}<br>t-SNE 2: %{y:.2f}<extra></extra>'
                };

                Plotly.newPlot('tsne-plot', [trace], {
                    title: 't-SNE 2D ì‹œê°í™”',
                    xaxis: { title: 't-SNE 1' },
                    yaxis: { title: 't-SNE 2' },
                    font: { family: 'Malgun Gothic, sans-serif' },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    plot_bgcolor: 'rgba(0,0,0,0)',
                    height: getChartHeight()
                }, { responsive: true });
            } else {
                const trace = {
                    x: data.data.map(d => d[0]),
                    y: data.data.map(d => d[1]),
                    z: data.data.map(d => d[2]),
                    mode: 'markers',
                    type: 'scatter3d',
                    marker: {
                        color: data.labels,
                        colorscale: [[0, '#48BBB4'], [1, '#FF6B9D']],
                        size: 3,
                        opacity: 0.7
                    },
                    text: data.labels.map(l => l === 0 ? 'ì–‘ì„± (B)' : 'ì•…ì„± (M)')
                };

                Plotly.newPlot('tsne-plot', [trace], {
                    title: 't-SNE 3D ì‹œê°í™”',
                    scene: {
                        xaxis: { title: 't-SNE 1' },
                        yaxis: { title: 't-SNE 2' },
                        zaxis: { title: 't-SNE 3' }
                    },
                    font: { family: 'Malgun Gothic, sans-serif' },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    height: getChartHeight()
                }, { responsive: true });
            }

        } catch (error) {
            console.error('t-SNE ì˜¤ë¥˜:', error);
            document.getElementById('tsne-chart').innerHTML = `<p>ì˜¤ë¥˜: ${error.message}</p>`;
        }
    }

    async function loadCorrelationMatrix() {
        document.getElementById('correlation-chart').innerHTML = '<div class="spinner"></div><p>ìƒê´€ê´€ê³„ í–‰ë ¬ ê³„ì‚° ì¤‘...</p>';

        try {
            const res = await fetch('/api/correlation/matrix');
            const data = await res.json();

            if (data.error) {
                document.getElementById('correlation-chart').innerHTML = `<p>ì˜¤ë¥˜: ${data.error}</p>`;
                return;
            }

            // íŠ¹ì§• ê°œìˆ˜ì— ë”°ë¼ ë†’ì´ì™€ í°íŠ¸ í¬ê¸° ë™ì  ì¡°ì ˆ
            const featureCount = data.features.length;
            
            // íˆíŠ¸ë§µ ì»¨í…Œì´ë„ˆ ë„ˆë¹„ ê°€ì ¸ì˜¤ê¸°
            const chartContainer = document.getElementById('correlation-chart').parentElement;
            const containerWidth = chartContainer.offsetWidth || 1200;
            
            // ì •ì‚¬ê°í˜• í˜•íƒœë¥¼ ìœ„í•´ ë†’ì´ë¥¼ ë„ˆë¹„ì— ë§ì¶¤ (ë§ˆì§„ ê³ ë ¤)
            const baseHeight = Math.max(700, containerWidth - 200);
            const dynamicHeight = Math.max(baseHeight, featureCount * 28);
            
            // í°íŠ¸ í¬ê¸°ì™€ ê°ë„ ë™ì  ì¡°ì ˆ
            let fontSize, tickAngle, dtick;
            if (featureCount > 40) {
                fontSize = 8;
                tickAngle = -70;
                dtick = Math.ceil(featureCount / 20);
            } else if (featureCount > 30) {
                fontSize = 9;
                tickAngle = -60;
                dtick = Math.ceil(featureCount / 18);
            } else if (featureCount > 20) {
                fontSize = 10;
                tickAngle = -50;
                dtick = Math.ceil(featureCount / 15);
            } else {
                fontSize = 11;
                tickAngle = -45;
                dtick = 1;
            }

            const correlationLayout = {
                title: { 
                    text: 'ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ',
                    font: { 
                        family: 'Malgun Gothic, sans-serif',
                        size: 18,
                        color: darkMode ? '#ffffff' : '#1e293b'
                    }
                },
                xaxis: { 
                    title: { 
                        text: 'íŠ¹ì§•',
                        font: { 
                            size: 14,
                            color: darkMode ? '#e2e8f0' : '#1e293b'
                        },
                        standoff: 20
                    },
                    tickangle: tickAngle,
                    tickfont: { 
                        size: fontSize,
                        color: darkMode ? '#cbd5e1' : '#475569'
                    },
                    automargin: true,
                    side: 'bottom',
                    dtick: dtick,
                    tickmode: 'linear',
                    showticklabels: true,
                    showgrid: false,
                    ticklen: 4,
                    tickwidth: 1
                },
                yaxis: { 
                    title: { 
                        text: 'íŠ¹ì§•',
                        font: { 
                            size: 14,
                            color: darkMode ? '#e2e8f0' : '#1e293b'
                        },
                        standoff: 20
                    },
                    tickfont: { 
                        size: fontSize,
                        color: darkMode ? '#cbd5e1' : '#475569'
                    },
                    automargin: true,
                    side: 'left',
                    dtick: dtick,
                    tickmode: 'linear',
                    showticklabels: true,
                    showgrid: false,
                    ticklen: 4,
                    tickwidth: 1
                },
                font: { 
                    family: 'Malgun Gothic, sans-serif',
                    size: fontSize,
                    color: darkMode ? '#e2e8f0' : '#1e293b'
                },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: dynamicHeight,
                autosize: true,
                margin: {
                    l: Math.max(120, featureCount * 3),
                    r: 80,
                    t: 80,
                    b: Math.max(150, featureCount * 3)
                },
                showlegend: true,
                coloraxis: {
                    colorbar: {
                        title: {
                            text: 'ìƒê´€ê³„ìˆ˜',
                            font: {
                                size: 12,
                                color: darkMode ? '#e2e8f0' : '#1e293b'
                            }
                        },
                        tickfont: {
                            size: 11,
                            color: darkMode ? '#cbd5e1' : '#475569'
                        },
                        len: 0.8,
                        y: 0.5,
                        yanchor: 'middle'
                    }
                }
            };
            
            // íˆíŠ¸ë§µì— í‘œì‹œí•  ìˆ«ì í…ìŠ¤íŠ¸ ìƒì„± (ì†Œìˆ˜ì  3ìë¦¬)
            // Plotly íˆíŠ¸ë§µì€ 2D ë°°ì—´ í˜•íƒœì˜ í…ìŠ¤íŠ¸ë¥¼ í•„ìš”ë¡œ í•¨
            const textValues = [];
            const textColors = [];
            
            for (let i = 0; i < data.matrix.length; i++) {
                textValues[i] = [];
                textColors[i] = [];
                for (let j = 0; j < data.matrix[i].length; j++) {
                    const val = data.matrix[i][j];
                    textValues[i][j] = val.toFixed(3);
                    // ì ˆëŒ“ê°’ì´ í° ê²½ìš° ë°ì€ ìƒ‰, ì‘ì€ ê²½ìš° ì–´ë‘ìš´ ìƒ‰
                    if (darkMode) {
                        textColors[i][j] = Math.abs(val) > 0.4 ? '#ffffff' : '#e2e8f0';
                    } else {
                        textColors[i][j] = Math.abs(val) > 0.4 ? '#ffffff' : '#1e293b';
                    }
                }
            }
            
            // í…ìŠ¤íŠ¸ í°íŠ¸ í¬ê¸° (íŠ¹ì§• ê°œìˆ˜ì— ë”°ë¼ ë™ì ìœ¼ë¡œ ì¡°ì ˆ)
            const textFontSize = Math.max(8, Math.min(11, 11 - Math.floor(featureCount / 12)));

            // ë‹¤í¬/ë¼ì´íŠ¸ ëª¨ë“œì— ë”°ë¥¸ ìƒ‰ìƒ ìŠ¤ì¼€ì¼ (ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜)
            let colorScale;
            if (darkMode) {
                // ë‹¤í¬ ëª¨ë“œ: ê¹Šì€ íŒŒë€ìƒ‰ â†’ ë°ì€ ë³´ë¼ìƒ‰ â†’ ë¶„í™ìƒ‰ â†’ ë”°ëœ»í•œ ë¹¨ê°„ìƒ‰ (ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜)
                colorScale = [
                    [0, 'rgb(8, 29, 88)'],        // ë§¤ìš° ì§„í•œ ë„¤ì´ë¹„ ë¸”ë£¨
                    [0.2, 'rgb(26, 65, 152)'],    // ì§„í•œ ë¸”ë£¨
                    [0.4, 'rgb(72, 72, 180)'],    // ë³´ë¼ ë¸”ë£¨
                    [0.5, 'rgb(100, 80, 160)'],   // ì¤‘ê°„ ë³´ë¼ìƒ‰
                    [0.6, 'rgb(150, 90, 180)'],   // ë°ì€ ë³´ë¼ìƒ‰
                    [0.8, 'rgb(220, 100, 140)'],  // ë”°ëœ»í•œ ë¶„í™ìƒ‰
                    [1, 'rgb(255, 120, 120)']     // ë°ì€ ì½”ë„ ë ˆë“œ
                ];
            } else {
                // ë¼ì´íŠ¸ ëª¨ë“œ: ê¹Šì€ ë¸”ë£¨ â†’ ë°ì€ ì‹œì•ˆ â†’ í¬ë¦¼ â†’ ì‚´ëª¬ â†’ ê¹Šì€ ë ˆë“œ (ìš°ì•„í•œ ê·¸ë¼ë°ì´ì…˜)
                colorScale = [
                    [0, 'rgb(5, 48, 97)'],        // ë„¤ì´ë¹„ ë¸”ë£¨
                    [0.2, 'rgb(66, 146, 198)'],   // ìŠ¤ì¹´ì´ ë¸”ë£¨
                    [0.4, 'rgb(118, 200, 221)'],  // ë°ì€ ì‹œì•ˆ
                    [0.5, 'rgb(250, 250, 250)'],  // ê±°ì˜ í°ìƒ‰
                    [0.6, 'rgb(255, 230, 204)'],  // í¬ë¦¼ìƒ‰
                    [0.8, 'rgb(255, 165, 140)'],  // ì‚´ëª¬ í•‘í¬
                    [1, 'rgb(220, 53, 69)']       // ì§„í•œ ë¡œì¦ˆ ë ˆë“œ
                ];
            }

            const finalCorrelationLayout = applyDarkModeToPlotlyLayout(correlationLayout);
            
            // íˆíŠ¸ë§µ íŠ¸ë ˆì´ìŠ¤ ìƒì„± - í…ìŠ¤íŠ¸ í‘œì‹œ í™•ì‹¤í•˜ê²Œ
            // Plotly íˆíŠ¸ë§µì—ì„œ í…ìŠ¤íŠ¸ë¥¼ í‘œì‹œí•˜ë ¤ë©´ textì™€ texttemplateì´ ëª¨ë‘ í•„ìš”
            const heatmapTrace = {
                z: data.matrix,
                x: data.features,
                y: data.features,
                type: 'heatmap',
                colorscale: colorScale,
                zmid: 0,
                zmin: -1,
                zmax: 1,
                text: textValues,
                texttemplate: '%{text}',
                textfont: {
                    size: textFontSize,
                    family: 'Malgun Gothic, sans-serif'
                },
                hovertemplate: '<b>%{fullData.x[%{point.x}]} vs %{fullData.y[%{point.y}]}</b><br>ìƒê´€ê³„ìˆ˜: %{z:.3f}<extra></extra>',
                showscale: true,
                hoverongaps: false,
                showlegend: false,
                transpose: false,
                xgap: 0.5,
                ygap: 0.5
            };

            // ë ˆì´ì•„ì›ƒì— í…ìŠ¤íŠ¸ í‘œì‹œë¥¼ ìœ„í•œ ì¶”ê°€ ì„¤ì •
            finalCorrelationLayout.showlegend = false;
            
            // íŠ¹ì§• ê°œìˆ˜ê°€ ì ì„ ë•Œ annotations ì¶”ê°€ (í…ìŠ¤íŠ¸ í‘œì‹œë¥¼ ìœ„í•œ ëŒ€ì•ˆ)
            // í•˜ì§€ë§Œ annotationsëŠ” ì„±ëŠ¥ ë¬¸ì œê°€ ìˆìœ¼ë¯€ë¡œ ì£¼ì„ ì²˜ë¦¬í•˜ê³  texttemplate ì‚¬ìš©
            // finalCorrelationLayout.annotations = [];
            
            // Plotly íˆíŠ¸ë§µ ìƒì„±
            const plotConfig = { 
                responsive: true,
                displayModeBar: true
            };
            
            Plotly.newPlot('correlation-chart', [heatmapTrace], finalCorrelationLayout, plotConfig);
            
            // ì°¨íŠ¸ ìƒì„± í›„ í…ìŠ¤íŠ¸ ê°•ì œ í‘œì‹œë¥¼ ìœ„í•œ ì¬ì‹œë„
            setTimeout(function() {
                const graphDiv = document.getElementById('correlation-chart');
                if (graphDiv) {
                    // í…ìŠ¤íŠ¸ í‘œì‹œë¥¼ í™•ì¸í•˜ê³  í•„ìš”ì‹œ ì—…ë°ì´íŠ¸
                    Plotly.redraw(graphDiv);
                    
                    // texttemplateì´ ì‘ë™í•˜ì§€ ì•Šìœ¼ë©´ annotations ì‚¬ìš©
                    if (featureCount <= 25) {
                        const annotations = [];
                        const cellWidth = 1 / featureCount;
                        const cellHeight = 1 / featureCount;
                        
                        for (let i = 0; i < featureCount && i < 25; i++) {
                            for (let j = 0; j < featureCount && j < 25; j++) {
                                const val = data.matrix[i][j];
                                annotations.push({
                                    x: j,
                                    y: i,
                                    text: val.toFixed(3),
                                    showarrow: false,
                                    font: {
                                        size: textFontSize,
                                        color: textColors[i][j],
                                        family: 'Malgun Gothic, sans-serif'
                                    },
                                    bgcolor: 'rgba(0,0,0,0)',
                                    bordercolor: 'rgba(0,0,0,0)'
                                });
                            }
                        }
                        
                        // annotations ì¶”ê°€ (í…ìŠ¤íŠ¸ê°€ í‘œì‹œë˜ì§€ ì•Šì„ ë•Œë§Œ)
                        Plotly.relayout(graphDiv, {
                            annotations: annotations
                        });
                    }
                }
            }, 500);

        } catch (error) {
            console.error('ìƒê´€ê´€ê³„ í–‰ë ¬ ì˜¤ë¥˜:', error);
            document.getElementById('correlation-chart').innerHTML = `<p>ì˜¤ë¥˜: ${error.message}</p>`;
        }
    }

    async function analyzeMalignant() {
        const btn = event.target;
        btn.disabled = true;
        btn.textContent = 'ë¶„ì„ ì¤‘...';

        document.getElementById('malignant-results').innerHTML = '<div class="spinner"></div><p>ì•…ì„± ì‹¬ê°ë„ ë¶„ì„ ì¤‘...</p>';

        try {
            const res = await fetch('/api/malignant/analyze');
            const data = await res.json();

            if (data.error) {
                document.getElementById('malignant-results').innerHTML = `<p>ì˜¤ë¥˜: ${data.error}</p>`;
                btn.disabled = false;
                btn.textContent = 'ì•…ì„± ì‹¬ê°ë„ ë¶„ì„ ì‹¤í–‰';
                return;
            }

            let resultsHTML = `
                <h3>ğŸ“Š ì•…ì„± ì‹¬ê°ë„ ë¶„í¬</h3>
                <div class="metric-grid" style="margin: 1rem 0;">
                    <div class="metric-card">
                        <label>ì €ì•…ì„± (0)</label>
                        <div class="value">${data.low_severity_count}</div>
                    </div>
                    <div class="metric-card">
                        <label>ê³ ì•…ì„± (1)</label>
                        <div class="value">${data.high_severity_count}</div>
                    </div>
                    <div class="metric-card">
                        <label>ê³ ì•…ì„± ë¹„ìœ¨</label>
                        <div class="value">${data.high_severity_pct}%</div>
                    </div>
                    <div class="metric-card">
                        <label>ëª¨ë¸ ì •í™•ë„</label>
                        <div class="value">${(data.model_accuracy * 100).toFixed(2)}%</div>
                    </div>
                </div>

                <div class="widget-grid" style="margin-top: 2rem;">
                    <div class="chart-container">
                        <h3>ì•…ì„± ì‹¬ê°ë„ ë¶„í¬ (íŒŒì´ ì°¨íŠ¸)</h3>
                        <div id="malignant-severity-pie"></div>
                    </div>

                    <div class="chart-container">
                        <h3>í˜¼ë™í–‰ë ¬</h3>
                        <div id="malignant-cm"></div>
                    </div>

                    <div class="chart-container full-width-chart">
                        <h3>ì•…ì„± ì‹¬ê°ë„ ì˜ˆì¸¡ì— ì¤‘ìš”í•œ íŠ¹ì§• (ìƒìœ„ 15ê°œ)</h3>
                        <div id="malignant-importance"></div>
                    </div>
                </div>
            `;

            document.getElementById('malignant-results').innerHTML = resultsHTML;

            Plotly.newPlot('malignant-severity-pie', [{
                values: [data.low_severity_count, data.high_severity_count],
                labels: ['ì €ì•…ì„± (0)', 'ê³ ì•…ì„± (1)'],
                type: 'pie',
                marker: { colors: ['#48BBB4', '#FF6B9D'] },
                textinfo: 'label+percent',
                textposition: 'inside'
            }], {
                title: 'ì•…ì„± ì‹¬ê°ë„ ë¶„í¬',
                font: { family: 'Malgun Gothic, sans-serif' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: getChartHeight()
            }, { responsive: true });

            Plotly.newPlot('malignant-cm', [{
                z: data.confusion_matrix,
                type: 'heatmap',
                colorscale: 'Blues',
                text: data.confusion_matrix.map(row => row.map(val => val.toString())),
                texttemplate: '%{text}',
                textfont: { size: 16 },
                showscale: false
            }], {
                xaxis: { title: 'ì˜ˆì¸¡', tickvals: [0, 1], ticktext: ['ì €ì•…ì„±', 'ê³ ì•…ì„±'] },
                yaxis: { title: 'ì‹¤ì œ', tickvals: [0, 1], ticktext: ['ì €ì•…ì„±', 'ê³ ì•…ì„±'] },
                title: 'í˜¼ë™í–‰ë ¬',
                font: { family: 'Malgun Gothic, sans-serif' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: getChartHeight()
            }, { responsive: true });

            Plotly.newPlot('malignant-importance', [{
                x: data.feature_importance.importance,
                y: data.feature_importance.features,
                type: 'bar',
                orientation: 'h',
                marker: { color: data.feature_importance.importance, colorscale: 'Reds' }
            }], {
                title: 'ì•…ì„± ì‹¬ê°ë„ ì˜ˆì¸¡ì— ì¤‘ìš”í•œ íŠ¹ì§•',
                xaxis: { title: 'ì¤‘ìš”ë„' },
                yaxis: { title: 'íŠ¹ì§•' },
                font: { family: 'Malgun Gothic, sans-serif' },
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                height: getChartHeight(true)
            }, { responsive: true });

            btn.disabled = false;
            btn.textContent = 'ì•…ì„± ì‹¬ê°ë„ ë¶„ì„ ì‹¤í–‰';

        } catch (error) {
            console.error('ì•…ì„± ë¶„ì„ ì˜¤ë¥˜:', error);
            document.getElementById('malignant-results').innerHTML = `<p>ì˜¤ë¥˜: ${error.message}</p>`;
            btn.disabled = false;
            btn.textContent = 'ì•…ì„± ì‹¬ê°ë„ ë¶„ì„ ì‹¤í–‰';
        }
    }
</script>
</body>
</html>
